<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pool Pump Sizing Tool</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="title">Pool Pump Sizing Tool</div>
      <div class="actions">
        <button id="exportJsonBtn" class="btn">Export JSON</button>
        <label class="btn">
          Import JSON
          <input id="importJsonFile" type="file" accept="application/json" style="display:none" />
        </label>
        <button id="printBtn" class="btn">Print</button>
      </div>
    </header>

    <main class="grid">
      <!-- LEFT -->
      <section class="card">
        <h2>Project</h2>

        <div class="row2">
          <div class="field">
            <label>Client / Project Name</label>
            <input id="clientName" type="text" placeholder="e.g., Johnson Residence" />
          </div>
          <div class="field">
            <label>City / State</label>
            <input id="cityState" type="text" placeholder="e.g., Houston, TX" />
          </div>
        </div>

        <div class="row2">
          <div class="field">
            <label>Pool Volume (gallons)</label>
            <input id="poolVolume" type="number" min="0" step="1" placeholder="e.g., 18000" />
          </div>
          <div class="field">
            <label>Pool Turnover (hours)</label>
            <select id="poolTurnoverHours">
              <option value="6">6</option>
              <option value="8">8</option>
              <option value="10">10</option>
              <option value="12">12</option>
            </select>
          </div>
        </div>

        <h3>Water Features</h3>
        <div class="wf-header">
          <button id="addWaterFeatureBtn" class="btn">+ Add</button>
        </div>

        <div class="wf-table">
          <div class="wf-head">
            <div>Type</div><div>Qty</div><div>Width (ft)</div><div>GPM / ft</div><div>Row GPM</div><div></div>
          </div>
          <div id="waterFeaturesList"></div>
        </div>

        <div class="totals">
          <div class="total-row"><span>Pool Turnover Flow</span><strong id="poolTurnoverFlow">—</strong></div>
          <div class="total-row"><span>Water Features Flow</span><strong id="waterFeaturesFlow">—</strong></div>
          <div class="total-row"><span>Pool Mode Required Flow</span><strong id="poolRequiredFlow">—</strong></div>
        </div>

        <h3>SPA</h3>
        <div class="row2">
          <div class="field">
            <label>Spa Mode</label>
            <label style="display:flex; gap:8px; align-items:center;">
              <input id="spaModeToggle" type="checkbox" />
              <span>Enable</span>
            </label>
          </div>
          <div class="field">
            <label>Spa Pump Setup</label>
            <select id="spaPumpSetup">
              <option value="shared">Shared with Pool Pump (Valve Mode)</option>
              <option value="dedicated">Dedicated Spa Pump</option>
            </select>
          </div>
        </div>

        <div class="row2">
          <div class="field">
            <label>Spa Volume (gallons) (optional)</label>
            <input id="spaVolume" type="number" min="0" step="1" />
          </div>
          <div class="field">
            <label>Spa Turnover (hours) (optional)</label>
            <input id="spaTurnoverHours" type="number" min="0" step="0.5" />
          </div>
        </div>

        <div class="row2">
          <div class="field">
            <label>Spa Jets (Qty)</label>
            <input id="spaJetsQty" type="number" min="0" step="1" />
          </div>
          <div class="field">
            <label>GPM per Jet</label>
            <input id="gpmPerJet" type="number" min="0" step="0.1" />
          </div>
        </div>

        <div class="row2">
          <div class="field">
            <label>Spa Mode TDH (ft)</label>
            <input id="spaModeTdh" type="number" min="0" step="0.1" value="50" />
          </div>
          <div></div>
        </div>

        <div class="totals">
          <div class="total-row"><span>Spa Jets Flow</span><strong id="spaJetsFlow">—</strong></div>
          <div class="total-row"><span>Spa Turnover Flow</span><strong id="spaTurnoverFlow">—</strong></div>
          <div class="total-row"><span>Spa Mode Required Flow</span><strong id="spaRequiredFlow">—</strong></div>
        </div>

        <div class="modes">
          <div class="mode-card">
            <div class="mode-title">POOL MODE (Spa OFF)</div>
            <div id="poolModeRequired">Required: —</div>
            <div id="poolModeStatus" class="mode-status">—</div>
          </div>
          <div class="mode-card">
            <div class="mode-title">SPA MODE (Spa Only)</div>
            <div id="spaModeRequired">Required: —</div>
            <div id="spaModeStatus" class="mode-status">—</div>
          </div>
        </div>
      </section>

      <!-- RIGHT -->
      <section class="card">
        <div class="right-head">
          <h2>Pumps</h2>
          <button id="addPumpBtn" class="btn">+ Add Pump</button>
        </div>

        <div class="pump-table">
          <div class="pump-head">
            <div>Pump Model</div><div>Qty</div><div>System</div><div>TDH (ft)</div><div>Status</div><div></div>
          </div>
          <div id="pumpsList"></div>
        </div>

        <div class="curve-head">
          <h3>Curve Viewer</h3>
          <button id="editCurvesBtn" class="btn">Edit Curves</button>
        </div>

        <div class="curve-box">
          <canvas id="curveCanvas"></canvas>
        </div>

        <details class="card-lite" open>
          <summary>Engineering Inputs (optional TDH estimator)</summary>

          <div class="row2">
            <div class="field">
              <label>Equipment distance (one-way) (ft)</label>
              <input id="equipDistance" type="number" min="0" step="1" placeholder="e.g., 50" />
            </div>
            <div class="field">
              <label>Extra fittings allowance (ft)</label>
              <input id="extraFittings" type="number" min="0" step="1" value="60" />
            </div>
          </div>

          <div class="row2">
            <div class="field">
              <label>Pipe size (in)</label>
              <select id="pipeSize">
                <option value="1.5">1.5</option>
                <option value="2">2</option>
                <option value="2.5" selected>2.5</option>
                <option value="3">3</option>
              </select>
            </div>
            <div class="field">
              <label>Elevation (ft)</label>
              <input id="elevation" type="number" min="0" step="0.1" placeholder="e.g., 5" />
            </div>
          </div>

          <div class="row2">
            <div class="field">
              <label>Equipment head (ft)</label>
              <input id="equipmentHead" type="number" min="0" step="0.1" value="10" />
            </div>
            <div class="field">
              <label>C (Hazen-Williams)</label>
              <input id="hazenC" type="number" min="1" step="1" value="140" />
            </div>
          </div>

          <div class="row2">
            <div class="field">
              <label>Apply TDH to</label>
              <select id="applyTdhTo">
                <option value="shared">Shared pumps</option>
                <option value="pool">Pool pumps</option>
                <option value="features">Water feature pumps</option>
                <option value="spa">Spa pumps</option>
                <option value="all">All pumps</option>
              </select>
            </div>
            <div class="field" style="display:flex; align-items:flex-end; gap:10px;">
              <button id="estimateTdhBtn" class="btn">Estimate TDH</button>
              <div id="tdhSummary" class="tdh-pill">TDH: —</div>
            </div>
          </div>
        </details>
      </section>
    </main>
  </div>

  <!-- Curves Modal -->
  <div id="curvesModal" class="modal" style="display:none">
    <div class="modal-card">
      <div class="modal-head">
        <div>
          <div class="modal-title">Pump Curves</div>
          <div class="modal-sub">Paste points: GPM,TDH (one per line)</div>
        </div>
        <button id="closeCurvesBtn" class="btn">Close</button>
      </div>

      <div id="curveTabs" class="tabs"></div>
      <div id="curveEditor"></div>

      <div class="modal-actions">
        <button id="resetCurvesBtn" class="btn">Reset Defaults</button>
        <button id="saveCurvesBtn" class="btn">Save</button>
      </div>
    </div>
  </div>

  <!-- IMPORTANT: must be normal script (not module) -->
  <script src="./app.js"></script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pool Pump Sizing Tool</title>
  <link rel="stylesheet" href="./style.css" />
  <style>
    /* Minimal fallback styles (حتى لو style.css فاضي) */
    :root{
      --bg:#050b1c; --panel:#0b1228; --line:#1f2a44; --txt:#e5e7eb; --muted:#94a3b8;
      --btn:#111a33; --btn2:#0f172a; --accent:#38bdf8;
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--txt);}
    .wrap{max-width:1100px;margin:0 auto;padding:22px;}
    .top{display:flex;gap:14px;flex-wrap:wrap;align-items:flex-end;}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border:1px solid rgba(148,163,184,0.12); border-radius:16px; padding:14px;}
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px;}
    input,select,textarea{
      width:100%; box-sizing:border-box; border-radius:12px; border:1px solid rgba(148,163,184,0.18);
      background:rgba(2,6,23,0.35); color:var(--txt); padding:10px 12px; outline:none;
    }
    textarea{min-height:120px; resize:vertical; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .btn{
      border:1px solid rgba(148,163,184,0.18); background:rgba(2,6,23,0.35); color:var(--txt);
      padding:10px 12px; border-radius:12px; cursor:pointer;
    }
    .btn.primary{border-color:rgba(56,189,248,0.45);}
    .btn:hover{filter:brightness(1.08);}
    .sectionTitle{font-weight:700;margin:0 0 10px;}
    #curveViewer{margin-top:14px;}
    /* Modal */
    .modalBack{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:none;align-items:center;justify-content:center;padding:16px;}
    .modal{max-width:980px;width:100%; max-height:90vh; overflow:auto;}
    .modalHeader{display:flex;align-items:center;justify-content:space-between;gap:12px;}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 12px;}
    .tab{padding:8px 10px;border-radius:999px;border:1px solid rgba(148,163,184,0.18);background:rgba(2,6,23,0.35);cursor:pointer;}
    .tab.active{border-color:rgba(56,189,248,0.55); box-shadow:0 0 0 2px rgba(56,189,248,0.10) inset;}
    .rpmBlock{border-top:1px solid rgba(148,163,184,0.12); padding-top:12px; margin-top:12px;}
    .twoCol{display:grid;grid-template-columns:220px 1fr;gap:12px;align-items:start;}
    .small{font-size:12px;color:var(--muted);}
    .footerBtns{display:flex;gap:10px;justify-content:flex-end;margin-top:12px;}
  </style>
</head>

<body>
  <div class="wrap">
    <h2 style="margin:0 0 14px;">Pool Pump Sizing Tool</h2>

    <div class="top">
      <div class="card" style="flex:1;min-width:280px;">
        <div class="sectionTitle">Chart Inputs</div>
        <div class="row">
          <div>
            <label>Pump Model</label>
            <select id="pumpModelSelect">
              <!-- app.js will auto-fill -->
            </select>
          </div>

          <div>
            <label>Target TDH (ft)</label>
            <input id="tdhInput" type="number" step="0.1" value="50" />
          </div>

          <div>
            <label>Required Flow (GPM)</label>
            <input id="requiredFlowInput" type="number" step="0.1" value="94.2" />
          </div>

          <div style="display:flex;gap:10px;align-items:end;">
            <button class="btn primary" id="openCurvesBtn" style="width:100%;">Edit Curves</button>
          </div>
        </div>

        <p class="small" style="margin:10px 0 0;">
          صيغة النقاط داخل المنحنى: <b>GPM,TDH</b> (سطر لكل نقطة) مثل: <code>0,95</code>
        </p>
      </div>

      <div class="card" style="flex:1;min-width:320px;">
        <div class="sectionTitle">Curve Viewer</div>
        <div id="curveViewer">
          <!-- app.js will create canvas #curveCanvas if missing -->
          <canvas id="curveCanvas" style="width:100%;height:360px;border-radius:14px;background:rgba(2,6,23,0.25);display:block;"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Edit Curves -->
  <div class="modalBack" id="curvesModal">
    <div class="card modal">
      <div class="modalHeader">
        <div>
          <div class="sectionTitle" style="margin:0;">Pump Curves</div>
          <div class="small">Paste points: <b>GPM,TDH</b> (one per line)</div>
        </div>
        <div style="display:flex;gap:10px;">
          <button class="btn" id="closeCurvesBtn">Close</button>
        </div>
      </div>

      <!-- Tabs (match keys in app.js DEFAULT_CURVES) -->
      <div class="tabs" id="curveTabs">
        <button class="tab active" data-tab="jandy-vsflo-pro-2.7">Jandy VS FloPro 2.7 HP</button>
        <button class="tab" data-tab="jandy-vsflo-pro-1.85">Jandy VS FloPro 1.85 HP</button>
        <button class="tab" data-tab="jandy-fhpm-1.0">Jandy FloPro FHPM 1.0 HP</button>
        <button class="tab" data-tab="jandy-vsflo-pro-3.8">Jandy VS FloPro 3.8 HP</button>
      </div>

      <!-- Panels -->
      <div id="tabPanels">

        <!-- 2.7 -->
        <div class="panel" data-panel="jandy-vsflo-pro-2.7" style="display:block;">
          <div class="rpmBlock">
            <div class="twoCol">
              <div>
                <label>RPM</label>
                <input value="3450" disabled />
                <label style="margin-top:10px;">Label</label>
                <input value="3450 RPM" disabled />
              </div>
              <div>
                <label>Points</label>
                <textarea data-curve="jandy-vsflo-pro-2.7" data-rpm="3450"></textarea>
              </div>
            </div>
          </div>

          <div class="rpmBlock">
            <div class="twoCol">
              <div>
                <label>RPM</label>
                <input value="3000" disabled />
                <label style="margin-top:10px;">Label</label>
                <input value="3000 RPM" disabled />
              </div>
              <div>
                <label>Points</label>
                <textarea data-curve="jandy-vsflo-pro-2.7" data-rpm="3000"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- 1.85 -->
        <div class="panel" data-panel="jandy-vsflo-pro-1.85" style="display:none;">
          <div class="rpmBlock">
            <div class="twoCol">
              <div>
                <label>RPM</label>
                <input value="3450" disabled />
                <label style="margin-top:10px;">Label</label>
                <input value="3450 RPM" disabled />
              </div>
              <div>
                <label>Points</label>
                <textarea data-curve="jandy-vsflo-pro-1.85" data-rpm="3450"></textarea>
              </div>
            </div>
          </div>

          <div class="rpmBlock">
            <div class="twoCol">
              <div>
                <label>RPM</label>
                <input value="3000" disabled />
                <label style="margin-top:10px;">Label</label>
                <input value="3000 RPM" disabled />
              </div>
              <div>
                <label>Points</label>
                <textarea data-curve="jandy-vsflo-pro-1.85" data-rpm="3000"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- FHPM 1.0 -->
        <div class="panel" data-panel="jandy-fhpm-1.0" style="display:none;">
          <div class="rpmBlock">
            <div class="twoCol">
              <div>
                <label>RPM</label>
                <input value="3450" disabled />
                <label style="margin-top:10px;">Label</label>
                <input value="FHPM 1.0 (Hi)" disabled />
              </div>
              <div>
                <label>Points</label>
                <textarea data-curve="jandy-fhpm-1.0" data-rpm="3450"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- 3.8 -->
        <div class="panel" data-panel="jandy-vsflo-pro-3.8" style="display:none;">
          <div class="rpmBlock">
            <div class="twoCol">
              <div>
                <label>RPM</label>
                <input value="3450" disabled />
                <label style="margin-top:10px;">Label</label>
                <input value="3450 RPM" disabled />
              </div>
              <div>
                <label>Points</label>
                <textarea data-curve="jandy-vsflo-pro-3.8" data-rpm="3450"></textarea>
              </div>
            </div>
          </div>

          <div class="rpmBlock">
            <div class="twoCol">
              <div>
                <label>RPM</label>
                <input value="3000" disabled />
                <label style="margin-top:10px;">Label</label>
                <input value="3000 RPM" disabled />
              </div>
              <div>
                <label>Points</label>
                <textarea data-curve="jandy-vsflo-pro-3.8" data-rpm="3000"></textarea>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="footerBtns">
        <button class="btn" id="saveCurvesBtn">Save Curves</button>
      </div>
    </div>
  </div>

  <script>
    // simple modal + tabs (independent from app.js)
    const modal = document.getElementById("curvesModal");
    const openBtn = document.getElementById("openCurvesBtn");
    const closeBtn = document.getElementById("closeCurvesBtn");

    openBtn.addEventListener("click", () => { modal.style.display = "flex"; });
    closeBtn.addEventListener("click", () => { modal.style.display = "none"; });
    modal.addEventListener("click", (e) => { if (e.target === modal) modal.style.display = "none"; });

    const tabs = Array.from(document.querySelectorAll("#curveTabs .tab"));
    const panels = Array.from(document.querySelectorAll("#tabPanels .panel"));

    tabs.forEach(t => {
      t.addEventListener("click", () => {
        tabs.forEach(x => x.classList.remove("active"));
        t.classList.add("active");

        const key = t.getAttribute("data-tab");
        panels.forEach(p => p.style.display = (p.getAttribute("data-panel") === key) ? "block" : "none");

        // Also switch pump in chart to match selected tab (optional)
        if (window.PoolPumpApp?.setPump) window.PoolPumpApp.setPump(key);
      });
    });
  </script>

  <script src="./app.js"></script>
</body>
</html>

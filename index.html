<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pool Pump Sizing Tool</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    /* Small add-ons for PASS/FAIL badges + mode boxes */
    .modeBox{margin-top:10px;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px;background:rgba(0,0,0,.12)}
    .modeGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:650px){.modeGrid{grid-template-columns:1fr}}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:5px 10px;border-radius:999px;font-weight:800;font-size:12px;border:1px solid rgba(255,255,255,.12)}
    .ok{background:rgba(34,197,94,.15);border-color:rgba(34,197,94,.45)}
    .bad{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.45)}
    .mid{background:rgba(245,158,11,.15);border-color:rgba(245,158,11,.45)}
    .kpi{display:flex;justify-content:space-between;gap:10px;margin-top:6px;color:rgba(234,240,255,.85);font-size:13px}
    .kpi b{color:#eaf0ff}
    .muted2{color:rgba(234,240,255,.65);font-size:12px;margin-top:4px}
    .spaHeader{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .toggle{display:flex;align-items:center;gap:8px}
    .toggle input{width:auto;margin:0}
    .mini{font-size:12px;color:rgba(234,240,255,.75)}
  </style>
</head>

<body>
<header class="bar">
  <div class="t">Pool Pump Sizing Tool</div>
  <div class="a">
    <button id="btnExport">Export JSON</button>
    <label class="file">Import JSON<input id="fileImport" type="file" accept=".json"></label>
    <button id="btnPrint">Print</button>
  </div>
</header>

<main class="wrap">
  <section class="grid">

    <!-- LEFT: PROJECT / FLOWS -->
    <div class="card">
      <h2>Project</h2>

      <div class="g2">
        <label>Client / Project Name
          <input id="clientName" placeholder="e.g., Johnson Residence">
        </label>

        <label>City / State
          <input id="location" placeholder="e.g., Houston, TX">
        </label>

        <label>Pool Volume (gallons)
          <input id="poolVolume" type="number" min="0" placeholder="e.g., 18000">
        </label>

        <label>Pool Turnover (hours)
          <div class="row">
            <select id="turnoverPreset">
              <option value="6">6</option>
              <option value="8" selected>8</option>
              <option value="10">10</option>
              <option value="12">12</option>
              <option value="custom">Custom</option>
            </select>
            <input id="turnoverCustom" type="number" min="1" step="0.5" placeholder="Custom" disabled>
          </div>
        </label>
      </div>

      <div class="row between" style="margin-top:10px">
        <h3>Water Features</h3>
        <button id="addWF">+ Add</button>
      </div>

      <div class="tbl">
        <div class="th">
          <div>Type</div><div class="r">Qty</div><div class="r">Width (ft)</div><div class="r">GPM / ft</div><div class="r">Row GPM</div><div></div>
        </div>
        <div id="wfBody"></div>
      </div>

      <div class="sum">
        <div><span>Pool Turnover Flow</span><b id="turnoverGpm">—</b></div>
        <div><span>Water Features Flow</span><b id="wfGpm">—</b></div>
        <div class="tot"><span>Pool Mode Required Flow</span><b id="poolModeGpm">—</b></div>
      </div>

      <!-- SPA -->
      <div class="modeBox" style="margin-top:12px">
        <div class="spaHeader">
          <div>
            <b>SPA</b>
            <div class="muted2">Spa Mode = Spa Only (Pool + Features OFF)</div>
          </div>
          <div class="toggle">
            <span class="mini">Spa Mode</span>
            <input id="spaMode" type="checkbox">
          </div>
        </div>

        <div class="g2" style="margin-top:10px">
          <label>Spa Pump Setup
            <select id="spaSetup">
              <option value="shared" selected>Shared with Pool Pump (Valve Mode)</option>
              <option value="dedicated">Dedicated Spa Pump</option>
            </select>
          </label>

          <label>Spa Volume (gallons) (optional)
            <input id="spaVolume" type="number" min="0" placeholder="e.g., 800">
          </label>

          <label>Spa Turnover (hours) (optional)
            <input id="spaTurnover" type="number" min="0" step="0.5" placeholder="e.g., 1">
          </label>

          <label>Spa Jets (Qty)
            <input id="spaJets" type="number" min="0" step="1" value="0">
          </label>

          <label>GPM per Jet
            <input id="gpmPerJet" type="number" min="0" step="0.5" value="12">
          </label>

          <label>Spa Mode TDH (ft)
            <input id="spaTdh" type="number" min="0" step="0.5" value="50">
          </label>
        </div>

        <div class="sum" style="margin-top:10px">
          <div><span>Spa Jets Flow</span><b id="spaJetsGpm">—</b></div>
          <div><span>Spa Turnover Flow</span><b id="spaTurnoverGpm">—</b></div>
          <div class="tot"><span>Spa Mode Required Flow</span><b id="spaModeGpm">—</b></div>
        </div>
      </div>

      <!-- Mode Results -->
      <div class="modeBox">
        <div class="modeGrid">
          <div>
            <div class="kpi"><span><b>POOL MODE</b> (Spa OFF)</span><span id="poolModeBadge" class="badge mid">—</span></div>
            <div class="muted2" id="poolModeLine">Required: —</div>
          </div>
          <div>
            <div class="kpi"><span><b>SPA MODE</b> (Spa Only)</span><span id="spaModeBadge" class="badge mid">—</span></div>
            <div class="muted2" id="spaModeLine">Required: —</div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: PUMPS / CURVES -->
    <div class="card">
      <div class="row between">
        <h2>Pumps</h2>
        <button id="addPump">+ Add Pump</button>
      </div>

      <div class="muted2">Add unlimited pumps. Assign each pump to Pool / Water Features / Spa / Shared.</div>

      <div class="tbl">
        <div class="th pumps">
          <div>Pump Model</div><div class="r">Qty</div><div>System</div><div class="r">TDH (ft)</div><div class="r">Status</div><div></div>
        </div>
        <div id="pumpBody"></div>
      </div>

      <div class="row between" style="margin-top:12px">
        <h3>Curve Viewer</h3>
        <button id="btnEditCurves">Edit Curves</button>
      </div>

      <div class="chart"><canvas id="curveChart"></canvas></div>

      <details class="eng">
        <summary>Engineering Inputs (optional TDH estimator)</summary>
        <div class="g2">
          <label>Equipment distance (one-way) (ft)
            <input id="equipDistance" type="number" min="0" step="1" placeholder="e.g., 50">
          </label>
          <label>Extra fittings allowance (ft)
            <input id="fittingsEq" type="number" min="0" step="1" value="60">
          </label>

          <label>Pipe size (in)
            <select id="pipeSize">
              <option value="1.5">1.5</option>
              <option value="2">2</option>
              <option value="2.5" selected>2.5</option>
              <option value="3">3</option>
            </select>
          </label>

          <label>Elevation (ft)
            <input id="elev" type="number" step="0.5" placeholder="e.g., 5">
          </label>

          <label>Equipment head (ft)
            <input id="equipHead" type="number" step="0.5" value="10">
          </label>

          <label>C (Hazen–Williams)
            <input id="cHw" type="number" value="140">
          </label>

          <label>Apply TDH to
            <select id="applyTo">
              <option value="pool">Pool pumps</option>
              <option value="water">Water feature pumps</option>
              <option value="spa">Spa pumps</option>
              <option value="shared" selected>Shared pumps</option>
              <option value="all">All pumps</option>
            </select>
          </label>
        </div>

        <div class="row between">
          <button id="btnEstimateTdh">Estimate TDH</button>
          <div class="pill" id="tdhOut">TDH: —</div>
        </div>
      </details>
    </div>

  </section>
</main>

<!-- Curves Modal -->
<div class="modal" id="curvesModal" aria-hidden="true">
  <div class="mcard">
    <div class="row between">
      <div>
        <b>Pump Curves</b>
        <div class="small">Paste points: <b>GPM,TDH</b> (one per line)</div>
      </div>
      <button id="btnCloseCurves">Close</button>
    </div>
    <div id="curveTabs" class="tabs"></div>
    <div class="row between" style="margin-top:8px">
      <span class="small">RPM Lines</span>
      <button id="btnAddCurveLine">+ Add RPM</button>
    </div>
    <div id="curveLines"></div>
    <div class="row between" style="margin-top:10px">
      <button id="btnResetCurves">Reset Defaults</button>
      <button id="btnSaveCurves">Save</button>
    </div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
